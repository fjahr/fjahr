<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - total_coverage.info - src/test/descriptor_tests.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">src/test</a> - descriptor_tests.cpp<span style="font-size: 80%;"> (source / <a href="descriptor_tests.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">total_coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">229</td>
            <td class="headerCovTableEntry">234</td>
            <td class="headerCovTableEntryHi">97.9 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2020-09-26 01:30:44</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">15</td>
            <td class="headerCovTableEntry">15</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // Copyright (c) 2018-2020 The Bitcoin Core developers</a>
<a name="2"><span class="lineNum">       2 </span>            : // Distributed under the MIT software license, see the accompanying</a>
<a name="3"><span class="lineNum">       3 </span>            : // file COPYING or http://www.opensource.org/licenses/mit-license.php.</a>
<a name="4"><span class="lineNum">       4 </span>            : </a>
<a name="5"><span class="lineNum">       5 </span>            : #include &lt;script/descriptor.h&gt;</a>
<a name="6"><span class="lineNum">       6 </span>            : #include &lt;script/sign.h&gt;</a>
<a name="7"><span class="lineNum">       7 </span>            : #include &lt;script/standard.h&gt;</a>
<a name="8"><span class="lineNum">       8 </span>            : #include &lt;test/util/setup_common.h&gt;</a>
<a name="9"><span class="lineNum">       9 </span>            : #include &lt;util/strencodings.h&gt;</a>
<a name="10"><span class="lineNum">      10 </span>            : </a>
<a name="11"><span class="lineNum">      11 </span>            : #include &lt;boost/test/unit_test.hpp&gt;</a>
<a name="12"><span class="lineNum">      12 </span>            : </a>
<a name="13"><span class="lineNum">      13 </span>            : #include &lt;string&gt;</a>
<a name="14"><span class="lineNum">      14 </span>            : #include &lt;vector&gt;</a>
<a name="15"><span class="lineNum">      15 </span>            : </a>
<a name="16"><span class="lineNum">      16 </span>            : namespace {</a>
<a name="17"><span class="lineNum">      17 </span>            : </a>
<a name="18"><span class="lineNum">      18 </span><span class="lineCov">         36 : void CheckUnparsable(const std::string&amp; prv, const std::string&amp; pub, const std::string&amp; expected_error)</span></a>
<a name="19"><span class="lineNum">      19 </span>            : {</a>
<a name="20"><span class="lineNum">      20 </span><span class="lineCov">         36 :     FlatSigningProvider keys_priv, keys_pub;</span></a>
<a name="21"><span class="lineNum">      21 </span><span class="lineCov">         36 :     std::string error;</span></a>
<a name="22"><span class="lineNum">      22 </span><span class="lineCov">         36 :     auto parse_priv = Parse(prv, keys_priv, error);</span></a>
<a name="23"><span class="lineNum">      23 </span><span class="lineCov">         36 :     auto parse_pub = Parse(pub, keys_pub, error);</span></a>
<a name="24"><span class="lineNum">      24 </span><span class="lineCov">         36 :     BOOST_CHECK_MESSAGE(!parse_priv, prv);</span></a>
<a name="25"><span class="lineNum">      25 </span><span class="lineCov">         36 :     BOOST_CHECK_MESSAGE(!parse_pub, pub);</span></a>
<a name="26"><span class="lineNum">      26 </span><span class="lineCov">         36 :     BOOST_CHECK(error == expected_error);</span></a>
<a name="27"><span class="lineNum">      27 </span><span class="lineCov">         36 : }</span></a>
<a name="28"><span class="lineNum">      28 </span>            : </a>
<a name="29"><span class="lineNum">      29 </span>            : constexpr int DEFAULT = 0;</a>
<a name="30"><span class="lineNum">      30 </span>            : constexpr int RANGE = 1; // Expected to be ranged descriptor</a>
<a name="31"><span class="lineNum">      31 </span>            : constexpr int HARDENED = 2; // Derivation needs access to private keys</a>
<a name="32"><span class="lineNum">      32 </span>            : constexpr int UNSOLVABLE = 4; // This descriptor is not expected to be solvable</a>
<a name="33"><span class="lineNum">      33 </span>            : constexpr int SIGNABLE = 8; // We can sign with this descriptor (this is not true when actual BIP32 derivation is used, as that's not integrated in our signing code)</a>
<a name="34"><span class="lineNum">      34 </span>            : constexpr int DERIVE_HARDENED = 16; // The final derivation is hardened, i.e. ends with *' or *h</a>
<a name="35"><span class="lineNum">      35 </span>            : </a>
<a name="36"><span class="lineNum">      36 </span>            : /** Compare two descriptors. If only one of them has a checksum, the checksum is ignored. */</a>
<a name="37"><span class="lineNum">      37 </span><span class="lineCov">        212 : bool EqualDescriptor(std::string a, std::string b)</span></a>
<a name="38"><span class="lineNum">      38 </span>            : {</a>
<a name="39"><span class="lineNum">      39 </span><span class="lineCov">        212 :     bool a_check = (a.size() &gt; 9 &amp;&amp; a[a.size() - 9] == '#');</span></a>
<a name="40"><span class="lineNum">      40 </span><span class="lineCov">        212 :     bool b_check = (b.size() &gt; 9 &amp;&amp; b[b.size() - 9] == '#');</span></a>
<a name="41"><span class="lineNum">      41 </span><span class="lineCov">        212 :     if (a_check != b_check) {</span></a>
<a name="42"><span class="lineNum">      42 </span><span class="lineCov">        196 :         if (a_check) a = a.substr(0, a.size() - 9);</span></a>
<a name="43"><span class="lineNum">      43 </span><span class="lineCov">        196 :         if (b_check) b = b.substr(0, b.size() - 9);</span></a>
<a name="44"><span class="lineNum">      44 </span>            :     }</a>
<a name="45"><span class="lineNum">      45 </span><span class="lineCov">        212 :     return a == b;</span></a>
<a name="46"><span class="lineNum">      46 </span>            : }</a>
<a name="47"><span class="lineNum">      47 </span>            : </a>
<a name="48"><span class="lineNum">      48 </span><span class="lineCov">         32 : std::string UseHInsteadOfApostrophe(const std::string&amp; desc)</span></a>
<a name="49"><span class="lineNum">      49 </span>            : {</a>
<a name="50"><span class="lineNum">      50 </span><span class="lineCov">         32 :     std::string ret = desc;</span></a>
<a name="51"><span class="lineNum">      51 </span><span class="lineCov">         32 :     while (true) {</span></a>
<a name="52"><span class="lineNum">      52 </span><span class="lineCov">         72 :         auto it = ret.find('\'');</span></a>
<a name="53"><span class="lineNum">      53 </span><span class="lineCov">         72 :         if (it == std::string::npos) break;</span></a>
<a name="54"><span class="lineNum">      54 </span><span class="lineCov">         40 :         ret[it] = 'h';</span></a>
<a name="55"><span class="lineNum">      55 </span><span class="lineCov">         40 :     }</span></a>
<a name="56"><span class="lineNum">      56 </span>            : </a>
<a name="57"><span class="lineNum">      57 </span>            :     // GetDescriptorChecksum returns &quot;&quot; if the checksum exists but is bad.</a>
<a name="58"><span class="lineNum">      58 </span>            :     // Switching apostrophes with 'h' breaks the checksum if it exists - recalculate it and replace the broken one.</a>
<a name="59"><span class="lineNum">      59 </span><span class="lineCov">         32 :     if (GetDescriptorChecksum(ret) == &quot;&quot;) {</span></a>
<a name="60"><span class="lineNum">      60 </span><span class="lineCov">          4 :         ret = ret.substr(0, desc.size() - 9);</span></a>
<a name="61"><span class="lineNum">      61 </span><span class="lineCov">          4 :         ret += std::string(&quot;#&quot;) + GetDescriptorChecksum(ret);</span></a>
<a name="62"><span class="lineNum">      62 </span><span class="lineCov">          4 :     }</span></a>
<a name="63"><span class="lineNum">      63 </span>            :     return ret;</a>
<a name="64"><span class="lineNum">      64 </span><span class="lineCov">         32 : }</span></a>
<a name="65"><span class="lineNum">      65 </span>            : </a>
<a name="66"><span class="lineNum">      66 </span><span class="lineCov">         89 : const std::set&lt;std::vector&lt;uint32_t&gt;&gt; ONLY_EMPTY{{}};</span></a>
<a name="67"><span class="lineNum">      67 </span>            : </a>
<a name="68"><span class="lineNum">      68 </span><span class="lineCov">         53 : void DoCheck(const std::string&amp; prv, const std::string&amp; pub, int flags, const std::vector&lt;std::vector&lt;std::string&gt;&gt;&amp; scripts, const Optional&lt;OutputType&gt;&amp; type, const std::set&lt;std::vector&lt;uint32_t&gt;&gt;&amp; paths = ONLY_EMPTY,</span></a>
<a name="69"><span class="lineNum">      69 </span>            :     bool replace_apostrophe_with_h_in_prv=false, bool replace_apostrophe_with_h_in_pub=false)</a>
<a name="70"><span class="lineNum">      70 </span>            : {</a>
<a name="71"><span class="lineNum">      71 </span><span class="lineCov">         53 :     FlatSigningProvider keys_priv, keys_pub;</span></a>
<a name="72"><span class="lineNum">      72 </span><span class="lineCov">         53 :     std::set&lt;std::vector&lt;uint32_t&gt;&gt; left_paths = paths;</span></a>
<a name="73"><span class="lineNum">      73 </span><span class="lineCov">         53 :     std::string error;</span></a>
<a name="74"><span class="lineNum">      74 </span>            : </a>
<a name="75"><span class="lineNum">      75 </span><span class="lineCov">         53 :     std::unique_ptr&lt;Descriptor&gt; parse_priv;</span></a>
<a name="76"><span class="lineNum">      76 </span><span class="lineCov">         53 :     std::unique_ptr&lt;Descriptor&gt; parse_pub;</span></a>
<a name="77"><span class="lineNum">      77 </span>            :     // Check that parsing succeeds.</a>
<a name="78"><span class="lineNum">      78 </span><span class="lineCov">         53 :     if (replace_apostrophe_with_h_in_prv) {</span></a>
<a name="79"><span class="lineNum">      79 </span><span class="lineCov">         16 :         parse_priv = Parse(UseHInsteadOfApostrophe(prv), keys_priv, error);</span></a>
<a name="80"><span class="lineNum">      80 </span><span class="lineCov">         16 :     } else {</span></a>
<a name="81"><span class="lineNum">      81 </span><span class="lineCov">         37 :         parse_priv = Parse(prv, keys_priv, error);</span></a>
<a name="82"><span class="lineNum">      82 </span>            :     }</a>
<a name="83"><span class="lineNum">      83 </span><span class="lineCov">         53 :     if (replace_apostrophe_with_h_in_pub) {</span></a>
<a name="84"><span class="lineNum">      84 </span><span class="lineCov">         16 :         parse_pub = Parse(UseHInsteadOfApostrophe(pub), keys_pub, error);</span></a>
<a name="85"><span class="lineNum">      85 </span><span class="lineCov">         16 :     } else {</span></a>
<a name="86"><span class="lineNum">      86 </span><span class="lineCov">         37 :         parse_pub = Parse(pub, keys_pub, error);</span></a>
<a name="87"><span class="lineNum">      87 </span>            :     }</a>
<a name="88"><span class="lineNum">      88 </span>            : </a>
<a name="89"><span class="lineNum">      89 </span><span class="lineCov">         53 :     BOOST_CHECK(parse_priv);</span></a>
<a name="90"><span class="lineNum">      90 </span><span class="lineCov">         53 :     BOOST_CHECK(parse_pub);</span></a>
<a name="91"><span class="lineNum">      91 </span>            : </a>
<a name="92"><span class="lineNum">      92 </span>            :     // Check that the correct OutputType is inferred</a>
<a name="93"><span class="lineNum">      93 </span><span class="lineCov">         53 :     BOOST_CHECK(parse_priv-&gt;GetOutputType() == type);</span></a>
<a name="94"><span class="lineNum">      94 </span><span class="lineCov">         53 :     BOOST_CHECK(parse_pub-&gt;GetOutputType() == type);</span></a>
<a name="95"><span class="lineNum">      95 </span>            : </a>
<a name="96"><span class="lineNum">      96 </span>            :     // Check private keys are extracted from the private version but not the public one.</a>
<a name="97"><span class="lineNum">      97 </span><span class="lineCov">         53 :     BOOST_CHECK(keys_priv.keys.size());</span></a>
<a name="98"><span class="lineNum">      98 </span><span class="lineCov">         53 :     BOOST_CHECK(!keys_pub.keys.size());</span></a>
<a name="99"><span class="lineNum">      99 </span>            : </a>
<a name="100"><span class="lineNum">     100 </span>            :     // Check that both versions serialize back to the public version.</a>
<a name="101"><span class="lineNum">     101 </span><span class="lineCov">         53 :     std::string pub1 = parse_priv-&gt;ToString();</span></a>
<a name="102"><span class="lineNum">     102 </span><span class="lineCov">         53 :     std::string pub2 = parse_pub-&gt;ToString();</span></a>
<a name="103"><span class="lineNum">     103 </span><span class="lineCov">         53 :     BOOST_CHECK(EqualDescriptor(pub, pub1));</span></a>
<a name="104"><span class="lineNum">     104 </span><span class="lineCov">         53 :     BOOST_CHECK(EqualDescriptor(pub, pub2));</span></a>
<a name="105"><span class="lineNum">     105 </span>            : </a>
<a name="106"><span class="lineNum">     106 </span>            :     // Check that both can be serialized with private key back to the private version, but not without private key.</a>
<a name="107"><span class="lineNum">     107 </span><span class="lineCov">         53 :     std::string prv1;</span></a>
<a name="108"><span class="lineNum">     108 </span><span class="lineCov">         53 :     BOOST_CHECK(parse_priv-&gt;ToPrivateString(keys_priv, prv1));</span></a>
<a name="109"><span class="lineNum">     109 </span><span class="lineCov">         53 :     BOOST_CHECK(EqualDescriptor(prv, prv1));</span></a>
<a name="110"><span class="lineNum">     110 </span><span class="lineCov">         53 :     BOOST_CHECK(!parse_priv-&gt;ToPrivateString(keys_pub, prv1));</span></a>
<a name="111"><span class="lineNum">     111 </span><span class="lineCov">         53 :     BOOST_CHECK(parse_pub-&gt;ToPrivateString(keys_priv, prv1));</span></a>
<a name="112"><span class="lineNum">     112 </span><span class="lineCov">         53 :     BOOST_CHECK(EqualDescriptor(prv, prv1));</span></a>
<a name="113"><span class="lineNum">     113 </span><span class="lineCov">         53 :     BOOST_CHECK(!parse_pub-&gt;ToPrivateString(keys_pub, prv1));</span></a>
<a name="114"><span class="lineNum">     114 </span>            : </a>
<a name="115"><span class="lineNum">     115 </span>            :     // Check whether IsRange on both returns the expected result</a>
<a name="116"><span class="lineNum">     116 </span><span class="lineCov">         53 :     BOOST_CHECK_EQUAL(parse_pub-&gt;IsRange(), (flags &amp; RANGE) != 0);</span></a>
<a name="117"><span class="lineNum">     117 </span><span class="lineCov">         53 :     BOOST_CHECK_EQUAL(parse_priv-&gt;IsRange(), (flags &amp; RANGE) != 0);</span></a>
<a name="118"><span class="lineNum">     118 </span>            : </a>
<a name="119"><span class="lineNum">     119 </span>            :     // * For ranged descriptors,  the `scripts` parameter is a list of expected result outputs, for subsequent</a>
<a name="120"><span class="lineNum">     120 </span>            :     //   positions to evaluate the descriptors on (so the first element of `scripts` is for evaluating the</a>
<a name="121"><span class="lineNum">     121 </span>            :     //   descriptor at 0; the second at 1; and so on). To verify this, we evaluate the descriptors once for</a>
<a name="122"><span class="lineNum">     122 </span>            :     //   each element in `scripts`.</a>
<a name="123"><span class="lineNum">     123 </span>            :     // * For non-ranged descriptors, we evaluate the descriptors at positions 0, 1, and 2, but expect the</a>
<a name="124"><span class="lineNum">     124 </span>            :     //   same result in each case, namely the first element of `scripts`. Because of that, the size of</a>
<a name="125"><span class="lineNum">     125 </span>            :     //   `scripts` must be one in that case.</a>
<a name="126"><span class="lineNum">     126 </span><span class="lineCov">         53 :     if (!(flags &amp; RANGE)) assert(scripts.size() == 1);</span></a>
<a name="127"><span class="lineNum">     127 </span><span class="lineCov">         53 :     size_t max = (flags &amp; RANGE) ? scripts.size() : 3;</span></a>
<a name="128"><span class="lineNum">     128 </span>            : </a>
<a name="129"><span class="lineNum">     129 </span>            :     // Iterate over the position we'll evaluate the descriptors in.</a>
<a name="130"><span class="lineNum">     130 </span><span class="lineCov">        211 :     for (size_t i = 0; i &lt; max; ++i) {</span></a>
<a name="131"><span class="lineNum">     131 </span>            :         // Call the expected result scripts `ref`.</a>
<a name="132"><span class="lineNum">     132 </span><span class="lineCov">        158 :         const auto&amp; ref = scripts[(flags &amp; RANGE) ? i : 0];</span></a>
<a name="133"><span class="lineNum">     133 </span>            :         // When t=0, evaluate the `prv` descriptor; when t=1, evaluate the `pub` descriptor.</a>
<a name="134"><span class="lineNum">     134 </span><span class="lineCov">        474 :         for (int t = 0; t &lt; 2; ++t) {</span></a>
<a name="135"><span class="lineNum">     135 </span>            :             // When the descriptor is hardened, evaluate with access to the private keys inside.</a>
<a name="136"><span class="lineNum">     136 </span><span class="lineCov">        316 :             const FlatSigningProvider&amp; key_provider = (flags &amp; HARDENED) ? keys_priv : keys_pub;</span></a>
<a name="137"><span class="lineNum">     137 </span>            : </a>
<a name="138"><span class="lineNum">     138 </span>            :             // Evaluate the descriptor selected by `t` in position `i`.</a>
<a name="139"><span class="lineNum">     139 </span><span class="lineCov">        316 :             FlatSigningProvider script_provider, script_provider_cached;</span></a>
<a name="140"><span class="lineNum">     140 </span><span class="lineCov">        316 :             std::vector&lt;CScript&gt; spks, spks_cached;</span></a>
<a name="141"><span class="lineNum">     141 </span><span class="lineCov">        316 :             DescriptorCache desc_cache;</span></a>
<a name="142"><span class="lineNum">     142 </span><span class="lineCov">        316 :             BOOST_CHECK((t ? parse_priv : parse_pub)-&gt;Expand(i, key_provider, spks, script_provider, &amp;desc_cache));</span></a>
<a name="143"><span class="lineNum">     143 </span>            : </a>
<a name="144"><span class="lineNum">     144 </span>            :             // Compare the output with the expected result.</a>
<a name="145"><span class="lineNum">     145 </span><span class="lineCov">        316 :             BOOST_CHECK_EQUAL(spks.size(), ref.size());</span></a>
<a name="146"><span class="lineNum">     146 </span>            : </a>
<a name="147"><span class="lineNum">     147 </span>            :             // Try to expand again using cached data, and compare.</a>
<a name="148"><span class="lineNum">     148 </span><span class="lineCov">        316 :             BOOST_CHECK(parse_pub-&gt;ExpandFromCache(i, desc_cache, spks_cached, script_provider_cached));</span></a>
<a name="149"><span class="lineNum">     149 </span><span class="lineCov">        316 :             BOOST_CHECK(spks == spks_cached);</span></a>
<a name="150"><span class="lineNum">     150 </span><span class="lineCov">        316 :             BOOST_CHECK(script_provider.pubkeys == script_provider_cached.pubkeys);</span></a>
<a name="151"><span class="lineNum">     151 </span><span class="lineCov">        316 :             BOOST_CHECK(script_provider.scripts == script_provider_cached.scripts);</span></a>
<a name="152"><span class="lineNum">     152 </span><span class="lineCov">        316 :             BOOST_CHECK(script_provider.origins == script_provider_cached.origins);</span></a>
<a name="153"><span class="lineNum">     153 </span>            : </a>
<a name="154"><span class="lineNum">     154 </span>            :             // Check whether keys are in the cache</a>
<a name="155"><span class="lineNum">     155 </span><span class="lineCov">        316 :             const auto&amp; der_xpub_cache = desc_cache.GetCachedDerivedExtPubKeys();</span></a>
<a name="156"><span class="lineNum">     156 </span><span class="lineCov">        316 :             const auto&amp; parent_xpub_cache = desc_cache.GetCachedParentExtPubKeys();</span></a>
<a name="157"><span class="lineNum">     157 </span><span class="lineCov">        316 :             if ((flags &amp; RANGE) &amp;&amp; !(flags &amp; DERIVE_HARDENED)) {</span></a>
<a name="158"><span class="lineNum">     158 </span>            :                 // For ranged, unhardened derivation, None of the keys in origins should appear in the cache but the cache should have parent keys</a>
<a name="159"><span class="lineNum">     159 </span>            :                 // But we can derive one level from each of those parent keys and find them all</a>
<a name="160"><span class="lineNum">     160 </span><span class="lineCov">         34 :                 BOOST_CHECK(der_xpub_cache.empty());</span></a>
<a name="161"><span class="lineNum">     161 </span><span class="lineCov">         34 :                 BOOST_CHECK(parent_xpub_cache.size() &gt; 0);</span></a>
<a name="162"><span class="lineNum">     162 </span><span class="lineCov">         34 :                 std::set&lt;CPubKey&gt; pubkeys;</span></a>
<a name="163"><span class="lineNum">     163 </span><span class="lineCov">         74 :                 for (const auto&amp; xpub_pair : parent_xpub_cache) {</span></a>
<a name="164"><span class="lineNum">     164 </span><span class="lineCov">         40 :                     const CExtPubKey&amp; xpub = xpub_pair.second;</span></a>
<a name="165"><span class="lineNum">     165 </span><span class="lineCov">         40 :                     CExtPubKey der;</span></a>
<a name="166"><span class="lineNum">     166 </span><span class="lineCov">         40 :                     xpub.Derive(der, i);</span></a>
<a name="167"><span class="lineNum">     167 </span><span class="lineCov">         40 :                     pubkeys.insert(der.pubkey);</span></a>
<a name="168"><span class="lineNum">     168 </span><span class="lineCov">         40 :                 }</span></a>
<a name="169"><span class="lineNum">     169 </span><span class="lineCov">         74 :                 for (const auto&amp; origin_pair : script_provider_cached.origins) {</span></a>
<a name="170"><span class="lineNum">     170 </span><span class="lineCov">         40 :                     const CPubKey&amp; pk = origin_pair.second.first;</span></a>
<a name="171"><span class="lineNum">     171 </span><span class="lineCov">         40 :                     BOOST_CHECK(pubkeys.count(pk) &gt; 0);</span></a>
<a name="172"><span class="lineNum">     172 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="173"><span class="lineNum">     173 </span><span class="lineCov">        316 :             } else if (pub1.find(&quot;xpub&quot;) != std::string::npos) {</span></a>
<a name="174"><span class="lineNum">     174 </span>            :                 // For ranged, hardened derivation, or not ranged, but has an xpub, all of the keys should appear in the cache</a>
<a name="175"><span class="lineNum">     175 </span><span class="lineCov">        156 :                 BOOST_CHECK(der_xpub_cache.size() + parent_xpub_cache.size() == script_provider_cached.origins.size());</span></a>
<a name="176"><span class="lineNum">     176 </span>            :                 // Get all of the derived pubkeys</a>
<a name="177"><span class="lineNum">     177 </span><span class="lineCov">        156 :                 std::set&lt;CPubKey&gt; pubkeys;</span></a>
<a name="178"><span class="lineNum">     178 </span><span class="lineCov">        204 :                 for (const auto&amp; xpub_map_pair : der_xpub_cache) {</span></a>
<a name="179"><span class="lineNum">     179 </span><span class="lineCov">         96 :                     for (const auto&amp; xpub_pair : xpub_map_pair.second) {</span></a>
<a name="180"><span class="lineNum">     180 </span><span class="lineCov">         48 :                         const CExtPubKey&amp; xpub = xpub_pair.second;</span></a>
<a name="181"><span class="lineNum">     181 </span><span class="lineCov">         48 :                         pubkeys.insert(xpub.pubkey);</span></a>
<a name="182"><span class="lineNum">     182 </span><span class="lineNoCov">          0 :                     }</span></a>
<a name="183"><span class="lineNum">     183 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="184"><span class="lineNum">     184 </span>            :                 // Derive one level from all of the parents</a>
<a name="185"><span class="lineNum">     185 </span><span class="lineCov">        384 :                 for (const auto&amp; xpub_pair : parent_xpub_cache) {</span></a>
<a name="186"><span class="lineNum">     186 </span><span class="lineCov">        228 :                     const CExtPubKey&amp; xpub = xpub_pair.second;</span></a>
<a name="187"><span class="lineNum">     187 </span><span class="lineCov">        228 :                     pubkeys.insert(xpub.pubkey);</span></a>
<a name="188"><span class="lineNum">     188 </span><span class="lineCov">        228 :                     CExtPubKey der;</span></a>
<a name="189"><span class="lineNum">     189 </span><span class="lineCov">        228 :                     xpub.Derive(der, i);</span></a>
<a name="190"><span class="lineNum">     190 </span><span class="lineCov">        228 :                     pubkeys.insert(der.pubkey);</span></a>
<a name="191"><span class="lineNum">     191 </span><span class="lineCov">        228 :                 }</span></a>
<a name="192"><span class="lineNum">     192 </span><span class="lineCov">        432 :                 for (const auto&amp; origin_pair : script_provider_cached.origins) {</span></a>
<a name="193"><span class="lineNum">     193 </span><span class="lineCov">        276 :                     const CPubKey&amp; pk = origin_pair.second.first;</span></a>
<a name="194"><span class="lineNum">     194 </span><span class="lineCov">        276 :                     BOOST_CHECK(pubkeys.count(pk) &gt; 0);</span></a>
<a name="195"><span class="lineNum">     195 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="196"><span class="lineNum">     196 </span><span class="lineCov">        156 :             } else {</span></a>
<a name="197"><span class="lineNum">     197 </span>            :                 // No xpub, nothing should be cached</a>
<a name="198"><span class="lineNum">     198 </span><span class="lineCov">        126 :                 BOOST_CHECK(der_xpub_cache.empty());</span></a>
<a name="199"><span class="lineNum">     199 </span><span class="lineCov">        126 :                 BOOST_CHECK(parent_xpub_cache.empty());</span></a>
<a name="200"><span class="lineNum">     200 </span>            :             }</a>
<a name="201"><span class="lineNum">     201 </span>            : </a>
<a name="202"><span class="lineNum">     202 </span>            :             // Make sure we can expand using cached xpubs for unhardened derivation</a>
<a name="203"><span class="lineNum">     203 </span><span class="lineCov">        316 :             if (!(flags &amp; DERIVE_HARDENED)) {</span></a>
<a name="204"><span class="lineNum">     204 </span>            :                 // Evaluate the descriptor at i + 1</a>
<a name="205"><span class="lineNum">     205 </span><span class="lineCov">        268 :                 FlatSigningProvider script_provider1, script_provider_cached1;</span></a>
<a name="206"><span class="lineNum">     206 </span><span class="lineCov">        268 :                 std::vector&lt;CScript&gt; spks1, spk1_from_cache;</span></a>
<a name="207"><span class="lineNum">     207 </span><span class="lineCov">        268 :                 BOOST_CHECK((t ? parse_priv : parse_pub)-&gt;Expand(i + 1, key_provider, spks1, script_provider1, nullptr));</span></a>
<a name="208"><span class="lineNum">     208 </span>            : </a>
<a name="209"><span class="lineNum">     209 </span>            :                 // Try again but use the cache from expanding i. That cache won't have the pubkeys for i + 1, but will have the parent xpub for derivation.</a>
<a name="210"><span class="lineNum">     210 </span><span class="lineCov">        268 :                 BOOST_CHECK(parse_pub-&gt;ExpandFromCache(i + 1, desc_cache, spk1_from_cache, script_provider_cached1));</span></a>
<a name="211"><span class="lineNum">     211 </span><span class="lineCov">        268 :                 BOOST_CHECK(spks1 == spk1_from_cache);</span></a>
<a name="212"><span class="lineNum">     212 </span><span class="lineCov">        268 :                 BOOST_CHECK(script_provider1.pubkeys == script_provider_cached1.pubkeys);</span></a>
<a name="213"><span class="lineNum">     213 </span><span class="lineCov">        268 :                 BOOST_CHECK(script_provider1.scripts == script_provider_cached1.scripts);</span></a>
<a name="214"><span class="lineNum">     214 </span><span class="lineCov">        268 :                 BOOST_CHECK(script_provider1.origins == script_provider_cached1.origins);</span></a>
<a name="215"><span class="lineNum">     215 </span><span class="lineCov">        268 :             }</span></a>
<a name="216"><span class="lineNum">     216 </span>            : </a>
<a name="217"><span class="lineNum">     217 </span>            :             // For each of the produced scripts, verify solvability, and when possible, try to sign a transaction spending it.</a>
<a name="218"><span class="lineNum">     218 </span><span class="lineCov">        686 :             for (size_t n = 0; n &lt; spks.size(); ++n) {</span></a>
<a name="219"><span class="lineNum">     219 </span><span class="lineCov">        370 :                 BOOST_CHECK_EQUAL(ref[n], HexStr(spks[n]));</span></a>
<a name="220"><span class="lineNum">     220 </span><span class="lineCov">        370 :                 BOOST_CHECK_EQUAL(IsSolvable(Merge(key_provider, script_provider), spks[n]), (flags &amp; UNSOLVABLE) == 0);</span></a>
<a name="221"><span class="lineNum">     221 </span>            : </a>
<a name="222"><span class="lineNum">     222 </span><span class="lineCov">        370 :                 if (flags &amp; SIGNABLE) {</span></a>
<a name="223"><span class="lineNum">     223 </span><span class="lineCov">        174 :                     CMutableTransaction spend;</span></a>
<a name="224"><span class="lineNum">     224 </span><span class="lineCov">        174 :                     spend.vin.resize(1);</span></a>
<a name="225"><span class="lineNum">     225 </span><span class="lineCov">        174 :                     spend.vout.resize(1);</span></a>
<a name="226"><span class="lineNum">     226 </span><span class="lineCov">        174 :                     BOOST_CHECK_MESSAGE(SignSignature(Merge(keys_priv, script_provider), spks[n], spend, 0, 1, SIGHASH_ALL), prv);</span></a>
<a name="227"><span class="lineNum">     227 </span><span class="lineCov">        174 :                 }</span></a>
<a name="228"><span class="lineNum">     228 </span>            : </a>
<a name="229"><span class="lineNum">     229 </span>            :                 /* Infer a descriptor from the generated script, and verify its solvability and that it roundtrips. */</a>
<a name="230"><span class="lineNum">     230 </span><span class="lineCov">        370 :                 auto inferred = InferDescriptor(spks[n], script_provider);</span></a>
<a name="231"><span class="lineNum">     231 </span><span class="lineCov">        370 :                 BOOST_CHECK_EQUAL(inferred-&gt;IsSolvable(), !(flags &amp; UNSOLVABLE));</span></a>
<a name="232"><span class="lineNum">     232 </span><span class="lineCov">        370 :                 std::vector&lt;CScript&gt; spks_inferred;</span></a>
<a name="233"><span class="lineNum">     233 </span><span class="lineCov">        370 :                 FlatSigningProvider provider_inferred;</span></a>
<a name="234"><span class="lineNum">     234 </span><span class="lineCov">        370 :                 BOOST_CHECK(inferred-&gt;Expand(0, provider_inferred, spks_inferred, provider_inferred));</span></a>
<a name="235"><span class="lineNum">     235 </span><span class="lineCov">        370 :                 BOOST_CHECK_EQUAL(spks_inferred.size(), 1U);</span></a>
<a name="236"><span class="lineNum">     236 </span><span class="lineCov">        370 :                 BOOST_CHECK(spks_inferred[0] == spks[n]);</span></a>
<a name="237"><span class="lineNum">     237 </span><span class="lineCov">        370 :                 BOOST_CHECK_EQUAL(IsSolvable(provider_inferred, spks_inferred[0]), !(flags &amp; UNSOLVABLE));</span></a>
<a name="238"><span class="lineNum">     238 </span><span class="lineCov">        370 :                 BOOST_CHECK(provider_inferred.origins == script_provider.origins);</span></a>
<a name="239"><span class="lineNum">     239 </span><span class="lineCov">        370 :             }</span></a>
<a name="240"><span class="lineNum">     240 </span>            : </a>
<a name="241"><span class="lineNum">     241 </span>            :             // Test whether the observed key path is present in the 'paths' variable (which contains expected, unobserved paths),</a>
<a name="242"><span class="lineNum">     242 </span>            :             // and then remove it from that set.</a>
<a name="243"><span class="lineNum">     243 </span><span class="lineCov">        866 :             for (const auto&amp; origin : script_provider.origins) {</span></a>
<a name="244"><span class="lineNum">     244 </span><span class="lineCov">        550 :                 BOOST_CHECK_MESSAGE(paths.count(origin.second.second.path), &quot;Unexpected key path: &quot; + prv);</span></a>
<a name="245"><span class="lineNum">     245 </span><span class="lineCov">        550 :                 left_paths.erase(origin.second.second.path);</span></a>
<a name="246"><span class="lineNum">     246 </span><span class="lineNoCov">          0 :             }</span></a>
<a name="247"><span class="lineNum">     247 </span><span class="lineCov">        316 :         }</span></a>
<a name="248"><span class="lineNum">     248 </span>            :     }</a>
<a name="249"><span class="lineNum">     249 </span>            : </a>
<a name="250"><span class="lineNum">     250 </span>            :     // Verify no expected paths remain that were not observed.</a>
<a name="251"><span class="lineNum">     251 </span><span class="lineCov">         53 :     BOOST_CHECK_MESSAGE(left_paths.empty(), &quot;Not all expected key paths found: &quot; + prv);</span></a>
<a name="252"><span class="lineNum">     252 </span><span class="lineCov">         53 : }</span></a>
<a name="253"><span class="lineNum">     253 </span>            : </a>
<a name="254"><span class="lineNum">     254 </span><span class="lineCov">         29 : void Check(const std::string&amp; prv, const std::string&amp; pub, int flags, const std::vector&lt;std::vector&lt;std::string&gt;&gt;&amp; scripts, const Optional&lt;OutputType&gt;&amp; type, const std::set&lt;std::vector&lt;uint32_t&gt;&gt;&amp; paths = ONLY_EMPTY)</span></a>
<a name="255"><span class="lineNum">     255 </span>            : {</a>
<a name="256"><span class="lineNum">     256 </span>            :     bool found_apostrophes_in_prv = false;</a>
<a name="257"><span class="lineNum">     257 </span>            :     bool found_apostrophes_in_pub = false;</a>
<a name="258"><span class="lineNum">     258 </span>            : </a>
<a name="259"><span class="lineNum">     259 </span>            :     // Do not replace apostrophes with 'h' in prv and pub</a>
<a name="260"><span class="lineNum">     260 </span><span class="lineCov">         29 :     DoCheck(prv, pub, flags, scripts, type, paths);</span></a>
<a name="261"><span class="lineNum">     261 </span>            : </a>
<a name="262"><span class="lineNum">     262 </span>            :     // Replace apostrophes with 'h' in prv but not in pub, if apostrophes are found in prv</a>
<a name="263"><span class="lineNum">     263 </span><span class="lineCov">         29 :     if (prv.find('\'') != std::string::npos) {</span></a>
<a name="264"><span class="lineNum">     264 </span>            :         found_apostrophes_in_prv = true;</a>
<a name="265"><span class="lineNum">     265 </span><span class="lineCov">          8 :         DoCheck(prv, pub, flags, scripts, type, paths, /* replace_apostrophe_with_h_in_prv = */true, /*replace_apostrophe_with_h_in_pub = */false);</span></a>
<a name="266"><span class="lineNum">     266 </span><span class="lineCov">          8 :     }</span></a>
<a name="267"><span class="lineNum">     267 </span>            : </a>
<a name="268"><span class="lineNum">     268 </span>            :     // Replace apostrophes with 'h' in pub but not in prv, if apostrophes are found in pub</a>
<a name="269"><span class="lineNum">     269 </span><span class="lineCov">         29 :     if (pub.find('\'') != std::string::npos) {</span></a>
<a name="270"><span class="lineNum">     270 </span>            :         found_apostrophes_in_pub = true;</a>
<a name="271"><span class="lineNum">     271 </span><span class="lineCov">          8 :         DoCheck(prv, pub, flags, scripts, type, paths, /* replace_apostrophe_with_h_in_prv = */false, /*replace_apostrophe_with_h_in_pub = */true);</span></a>
<a name="272"><span class="lineNum">     272 </span><span class="lineCov">          8 :     }</span></a>
<a name="273"><span class="lineNum">     273 </span>            : </a>
<a name="274"><span class="lineNum">     274 </span>            :     // Replace apostrophes with 'h' both in prv and in pub, if apostrophes are found in both</a>
<a name="275"><span class="lineNum">     275 </span><span class="lineCov">         29 :     if (found_apostrophes_in_prv &amp;&amp; found_apostrophes_in_pub) {</span></a>
<a name="276"><span class="lineNum">     276 </span><span class="lineCov">          8 :         DoCheck(prv, pub, flags, scripts, type, paths, /* replace_apostrophe_with_h_in_prv = */true, /*replace_apostrophe_with_h_in_pub = */true);</span></a>
<a name="277"><span class="lineNum">     277 </span><span class="lineCov">          8 :     }</span></a>
<a name="278"><span class="lineNum">     278 </span><span class="lineCov">         29 : }</span></a>
<a name="279"><span class="lineNum">     279 </span>            : </a>
<a name="280"><span class="lineNum">     280 </span>            : }</a>
<a name="281"><span class="lineNum">     281 </span>            : </a>
<a name="282"><span class="lineNum">     282 </span><span class="lineCov">         89 : BOOST_FIXTURE_TEST_SUITE(descriptor_tests, BasicTestingSetup)</span></a>
<a name="283"><span class="lineNum">     283 </span>            : </a>
<a name="284"><span class="lineNum">     284 </span><span class="lineCov">         95 : BOOST_AUTO_TEST_CASE(descriptor_test)</span></a>
<a name="285"><span class="lineNum">     285 </span>            : {</a>
<a name="286"><span class="lineNum">     286 </span>            :     // Basic single-key compressed</a>
<a name="287"><span class="lineNum">     287 </span><span class="lineCov">          4 :     Check(&quot;combo(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)&quot;, &quot;combo(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)&quot;, SIGNABLE, {{&quot;2103a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bdac&quot;,&quot;76a9149a1c78a507689f6f54b847ad1cef1e614ee23f1e88ac&quot;,&quot;00149a1c78a507689f6f54b847ad1cef1e614ee23f1e&quot;,&quot;a91484ab21b1b2fd065d4504ff693d832434b6108d7b87&quot;}}, nullopt);</span></a>
<a name="288"><span class="lineNum">     288 </span><span class="lineCov">          1 :     Check(&quot;pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)&quot;, &quot;pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)&quot;, SIGNABLE, {{&quot;2103a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bdac&quot;}}, nullopt);</span></a>
<a name="289"><span class="lineNum">     289 </span><span class="lineCov">          1 :     Check(&quot;pkh([deadbeef/1/2'/3/4']L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)&quot;, &quot;pkh([deadbeef/1/2'/3/4']03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)&quot;, SIGNABLE, {{&quot;76a9149a1c78a507689f6f54b847ad1cef1e614ee23f1e88ac&quot;}}, OutputType::LEGACY, {{1,0x80000002UL,3,0x80000004UL}});</span></a>
<a name="290"><span class="lineNum">     290 </span><span class="lineCov">          1 :     Check(&quot;wpkh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)&quot;, &quot;wpkh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)&quot;, SIGNABLE, {{&quot;00149a1c78a507689f6f54b847ad1cef1e614ee23f1e&quot;}}, OutputType::BECH32);</span></a>
<a name="291"><span class="lineNum">     291 </span><span class="lineCov">          1 :     Check(&quot;sh(wpkh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))&quot;, &quot;sh(wpkh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))&quot;, SIGNABLE, {{&quot;a91484ab21b1b2fd065d4504ff693d832434b6108d7b87&quot;}}, OutputType::P2SH_SEGWIT);</span></a>
<a name="292"><span class="lineNum">     292 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(wpkh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY2))&quot;, &quot;sh(wpkh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5))&quot;, &quot;Pubkey '03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5' is invalid&quot;); // Invalid pubkey</span></a>
<a name="293"><span class="lineNum">     293 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;pkh(deadbeef/1/2'/3/4']L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)&quot;, &quot;pkh(deadbeef/1/2'/3/4']03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)&quot;, &quot;Key origin start '[ character expected but not found, got 'd' instead&quot;); // Missing start bracket in key origin</span></a>
<a name="294"><span class="lineNum">     294 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;pkh([deadbeef]/1/2'/3/4']L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)&quot;, &quot;pkh([deadbeef]/1/2'/3/4']03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)&quot;, &quot;Multiple ']' characters found for a single pubkey&quot;); // Multiple end brackets in key origin</span></a>
<a name="295"><span class="lineNum">     295 </span>            : </a>
<a name="296"><span class="lineNum">     296 </span>            :     // Basic single-key uncompressed</a>
<a name="297"><span class="lineNum">     297 </span><span class="lineCov">          2 :     Check(&quot;combo(5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)&quot;, &quot;combo(04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)&quot;, SIGNABLE, {{&quot;4104a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235ac&quot;,&quot;76a914b5bd079c4d57cc7fc28ecf8213a6b791625b818388ac&quot;}}, nullopt);</span></a>
<a name="298"><span class="lineNum">     298 </span><span class="lineCov">          1 :     Check(&quot;pk(5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)&quot;, &quot;pk(04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)&quot;, SIGNABLE, {{&quot;4104a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235ac&quot;}}, nullopt);</span></a>
<a name="299"><span class="lineNum">     299 </span><span class="lineCov">          1 :     Check(&quot;pkh(5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)&quot;, &quot;pkh(04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)&quot;, SIGNABLE, {{&quot;76a914b5bd079c4d57cc7fc28ecf8213a6b791625b818388ac&quot;}}, OutputType::LEGACY);</span></a>
<a name="300"><span class="lineNum">     300 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wpkh(5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)&quot;, &quot;wpkh(04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)&quot;, &quot;Uncompressed keys are not allowed&quot;); // No uncompressed keys in witness</span></a>
<a name="301"><span class="lineNum">     301 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(pk(5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss))&quot;, &quot;wsh(pk(04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235))&quot;, &quot;Uncompressed keys are not allowed&quot;); // No uncompressed keys in witness</span></a>
<a name="302"><span class="lineNum">     302 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(wpkh(5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss))&quot;, &quot;sh(wpkh(04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235))&quot;, &quot;Uncompressed keys are not allowed&quot;); // No uncompressed keys in witness</span></a>
<a name="303"><span class="lineNum">     303 </span>            : </a>
<a name="304"><span class="lineNum">     304 </span>            :     // Some unconventional single-key constructions</a>
<a name="305"><span class="lineNum">     305 </span><span class="lineCov">          1 :     Check(&quot;sh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))&quot;, &quot;sh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))&quot;, SIGNABLE, {{&quot;a9141857af51a5e516552b3086430fd8ce55f7c1a52487&quot;}}, OutputType::LEGACY);</span></a>
<a name="306"><span class="lineNum">     306 </span><span class="lineCov">          1 :     Check(&quot;sh(pkh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))&quot;, &quot;sh(pkh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))&quot;, SIGNABLE, {{&quot;a9141a31ad23bf49c247dd531a623c2ef57da3c400c587&quot;}}, OutputType::LEGACY);</span></a>
<a name="307"><span class="lineNum">     307 </span><span class="lineCov">          1 :     Check(&quot;wsh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))&quot;, &quot;wsh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))&quot;, SIGNABLE, {{&quot;00202e271faa2325c199d25d22e1ead982e45b64eeb4f31e73dbdf41bd4b5fec23fa&quot;}}, OutputType::BECH32);</span></a>
<a name="308"><span class="lineNum">     308 </span><span class="lineCov">          1 :     Check(&quot;wsh(pkh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))&quot;, &quot;wsh(pkh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))&quot;, SIGNABLE, {{&quot;0020338e023079b91c58571b20e602d7805fb808c22473cbc391a41b1bd3a192e75b&quot;}}, OutputType::BECH32);</span></a>
<a name="309"><span class="lineNum">     309 </span><span class="lineCov">          1 :     Check(&quot;sh(wsh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)))&quot;, &quot;sh(wsh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))&quot;, SIGNABLE, {{&quot;a91472d0c5a3bfad8c3e7bd5303a72b94240e80b6f1787&quot;}}, OutputType::P2SH_SEGWIT);</span></a>
<a name="310"><span class="lineNum">     310 </span><span class="lineCov">          1 :     Check(&quot;sh(wsh(pkh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)))&quot;, &quot;sh(wsh(pkh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))&quot;, SIGNABLE, {{&quot;a914b61b92e2ca21bac1e72a3ab859a742982bea960a87&quot;}}, OutputType::P2SH_SEGWIT);</span></a>
<a name="311"><span class="lineNum">     311 </span>            : </a>
<a name="312"><span class="lineNum">     312 </span>            :     // Versions with BIP32 derivations</a>
<a name="313"><span class="lineNum">     313 </span><span class="lineCov">          4 :     Check(&quot;combo([01234567]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc)&quot;, &quot;combo([01234567]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL)&quot;, SIGNABLE, {{&quot;2102d2b36900396c9282fa14628566582f206a5dd0bcc8d5e892611806cafb0301f0ac&quot;,&quot;76a91431a507b815593dfc51ffc7245ae7e5aee304246e88ac&quot;,&quot;001431a507b815593dfc51ffc7245ae7e5aee304246e&quot;,&quot;a9142aafb926eb247cb18240a7f4c07983ad1f37922687&quot;}}, nullopt);</span></a>
<a name="314"><span class="lineNum">     314 </span><span class="lineCov">          1 :     Check(&quot;pk(xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0)&quot;, &quot;pk(xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0)&quot;, DEFAULT, {{&quot;210379e45b3cf75f9c5f9befd8e9506fb962f6a9d185ac87001ec44a8d3df8d4a9e3ac&quot;}}, nullopt, {{0}});</span></a>
<a name="315"><span class="lineNum">     315 </span><span class="lineCov">          1 :     Check(&quot;pkh(xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U/2147483647'/0)&quot;, &quot;pkh(xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/2147483647'/0)&quot;, HARDENED, {{&quot;76a914ebdc90806a9c4356c1c88e42216611e1cb4c1c1788ac&quot;}}, OutputType::LEGACY, {{0xFFFFFFFFUL,0}});</span></a>
<a name="316"><span class="lineNum">     316 </span><span class="lineCov">          5 :     Check(&quot;wpkh([ffffffff/13']xprv9vHkqa6EV4sPZHYqZznhT2NPtPCjKuDKGY38FBWLvgaDx45zo9WQRUT3dKYnjwih2yJD9mkrocEZXo1ex8G81dwSM1fwqWpWkeS3v86pgKt/1/2/*)&quot;, &quot;wpkh([ffffffff/13']xpub69H7F5d8KSRgmmdJg2KhpAK8SR3DjMwAdkxj3ZuxV27CprR9LgpeyGmXUbC6wb7ERfvrnKZjXoUmmDznezpbZb7ap6r1D3tgFxHmwMkQTPH/1/2/*)&quot;, RANGE, {{&quot;0014326b2249e3a25d5dc60935f044ee835d090ba859&quot;},{&quot;0014af0bd98abc2f2cae66e36896a39ffe2d32984fb7&quot;},{&quot;00141fa798efd1cbf95cebf912c031b8a4a6e9fb9f27&quot;}}, OutputType::BECH32, {{0x8000000DUL, 1, 2, 0}, {0x8000000DUL, 1, 2, 1}, {0x8000000DUL, 1, 2, 2}});</span></a>
<a name="317"><span class="lineNum">     317 </span><span class="lineCov">          5 :     Check(&quot;sh(wpkh(xprv9s21ZrQH143K3QTDL4LXw2F7HEK3wJUD2nW2nRk4stbPy6cq3jPPqjiChkVvvNKmPGJxWUtg6LnF5kejMRNNU3TGtRBeJgk33yuGBxrMPHi/10/20/30/40/*'))&quot;, &quot;sh(wpkh(xpub661MyMwAqRbcFtXgS5sYJABqqG9YLmC4Q1Rdap9gSE8NqtwybGhePY2gZ29ESFjqJoCu1Rupje8YtGqsefD265TMg7usUDFdp6W1EGMcet8/10/20/30/40/*'))&quot;, RANGE | HARDENED | DERIVE_HARDENED, {{&quot;a9149a4d9901d6af519b2a23d4a2f51650fcba87ce7b87&quot;},{&quot;a914bed59fc0024fae941d6e20a3b44a109ae740129287&quot;},{&quot;a9148483aa1116eb9c05c482a72bada4b1db24af654387&quot;}}, OutputType::P2SH_SEGWIT, {{10, 20, 30, 40, 0x80000000UL}, {10, 20, 30, 40, 0x80000001UL}, {10, 20, 30, 40, 0x80000002UL}});</span></a>
<a name="318"><span class="lineNum">     318 </span><span class="lineCov">          9 :     Check(&quot;combo(xprvA2JDeKCSNNZky6uBCviVfJSKyQ1mDYahRjijr5idH2WwLsEd4Hsb2Tyh8RfQMuPh7f7RtyzTtdrbdqqsunu5Mm3wDvUAKRHSC34sJ7in334/*)&quot;, &quot;combo(xpub6FHa3pjLCk84BayeJxFW2SP4XRrFd1JYnxeLeU8EqN3vDfZmbqBqaGJAyiLjTAwm6ZLRQUMv1ZACTj37sR62cfN7fe5JnJ7dh8zL4fiyLHV/*)&quot;, RANGE, {{&quot;2102df12b7035bdac8e3bab862a3a83d06ea6b17b6753d52edecba9be46f5d09e076ac&quot;,&quot;76a914f90e3178ca25f2c808dc76624032d352fdbdfaf288ac&quot;,&quot;0014f90e3178ca25f2c808dc76624032d352fdbdfaf2&quot;,&quot;a91408f3ea8c68d4a7585bf9e8bda226723f70e445f087&quot;},{&quot;21032869a233c9adff9a994e4966e5b821fd5bac066da6c3112488dc52383b4a98ecac&quot;,&quot;76a914a8409d1b6dfb1ed2a3e8aa5e0ef2ff26b15b75b788ac&quot;,&quot;0014a8409d1b6dfb1ed2a3e8aa5e0ef2ff26b15b75b7&quot;,&quot;a91473e39884cb71ae4e5ac9739e9225026c99763e6687&quot;}}, nullopt, {{0}, {1}});</span></a>
<a name="319"><span class="lineNum">     319 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;combo([012345678]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc)&quot;, &quot;combo([012345678]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL)&quot;, &quot;Fingerprint is not 4 bytes (9 characters instead of 8 characters)&quot;); // Too long key fingerprint</span></a>
<a name="320"><span class="lineNum">     320 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;pkh(xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U/2147483648)&quot;, &quot;pkh(xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/2147483648)&quot;, &quot;Key path value 2147483648 is out of range&quot;); // BIP 32 path element overflow</span></a>
<a name="321"><span class="lineNum">     321 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;pkh(xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U/1aa)&quot;, &quot;pkh(xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/1aa)&quot;, &quot;Key path value '1aa' is not a valid uint32&quot;); // Path is not valid uint</span></a>
<a name="322"><span class="lineNum">     322 </span>            : </a>
<a name="323"><span class="lineNum">     323 </span>            :     // Multisig constructions</a>
<a name="324"><span class="lineNum">     324 </span><span class="lineCov">          1 :     Check(&quot;multi(1,L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1,5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)&quot;, &quot;multi(1,03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd,04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)&quot;, SIGNABLE, {{&quot;512103a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd4104a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea23552ae&quot;}}, nullopt);</span></a>
<a name="325"><span class="lineNum">     325 </span><span class="lineCov">          1 :     Check(&quot;sortedmulti(1,L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1,5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)&quot;, &quot;sortedmulti(1,03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd,04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)&quot;, SIGNABLE, {{&quot;512103a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd4104a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea23552ae&quot;}}, nullopt);</span></a>
<a name="326"><span class="lineNum">     326 </span><span class="lineCov">          1 :     Check(&quot;sortedmulti(1,5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss,L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)&quot;, &quot;sortedmulti(1,04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235,03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)&quot;, SIGNABLE, {{&quot;512103a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd4104a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea23552ae&quot;}}, nullopt);</span></a>
<a name="327"><span class="lineNum">     327 </span><span class="lineCov">          2 :     Check(&quot;sh(multi(2,[00000000/111'/222]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0))&quot;, &quot;sh(multi(2,[00000000/111'/222]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0))&quot;, DEFAULT, {{&quot;a91445a9a622a8b0a1269944be477640eedc447bbd8487&quot;}}, OutputType::LEGACY, {{0x8000006FUL,222},{0}});</span></a>
<a name="328"><span class="lineNum">     328 </span><span class="lineCov">          8 :     Check(&quot;sortedmulti(2,xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc/*,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0/0/*)&quot;, &quot;sortedmulti(2,xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL/*,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0/0/*)&quot;, RANGE, {{&quot;5221025d5fc65ebb8d44a5274b53bac21ff8307fec2334a32df05553459f8b1f7fe1b62102fbd47cc8034098f0e6a94c6aeee8528abf0a2153a5d8e46d325b7284c046784652ae&quot;}, {&quot;52210264fd4d1f5dea8ded94c61e9641309349b62f27fbffe807291f664e286bfbe6472103f4ece6dfccfa37b211eb3d0af4d0c61dba9ef698622dc17eecdf764beeb005a652ae&quot;}, {&quot;5221022ccabda84c30bad578b13c89eb3b9544ce149787e5b538175b1d1ba259cbb83321024d902e1a2fc7a8755ab5b694c575fce742c48d9ff192e63df5193e4c7afe1f9c52ae&quot;}}, nullopt, {{0}, {1}, {2}, {0, 0, 0}, {0, 0, 1}, {0, 0, 2}});</span></a>
<a name="329"><span class="lineNum">     329 </span><span class="lineCov">          9 :     Check(&quot;wsh(multi(2,xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U/2147483647'/0,xprv9vHkqa6EV4sPZHYqZznhT2NPtPCjKuDKGY38FBWLvgaDx45zo9WQRUT3dKYnjwih2yJD9mkrocEZXo1ex8G81dwSM1fwqWpWkeS3v86pgKt/1/2/*,xprv9s21ZrQH143K3QTDL4LXw2F7HEK3wJUD2nW2nRk4stbPy6cq3jPPqjiChkVvvNKmPGJxWUtg6LnF5kejMRNNU3TGtRBeJgk33yuGBxrMPHi/10/20/30/40/*'))&quot;, &quot;wsh(multi(2,xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/2147483647'/0,xpub69H7F5d8KSRgmmdJg2KhpAK8SR3DjMwAdkxj3ZuxV27CprR9LgpeyGmXUbC6wb7ERfvrnKZjXoUmmDznezpbZb7ap6r1D3tgFxHmwMkQTPH/1/2/*,xpub661MyMwAqRbcFtXgS5sYJABqqG9YLmC4Q1Rdap9gSE8NqtwybGhePY2gZ29ESFjqJoCu1Rupje8YtGqsefD265TMg7usUDFdp6W1EGMcet8/10/20/30/40/*'))&quot;, HARDENED | RANGE | DERIVE_HARDENED, {{&quot;0020b92623201f3bb7c3771d45b2ad1d0351ea8fbf8cfe0a0e570264e1075fa1948f&quot;},{&quot;002036a08bbe4923af41cf4316817c93b8d37e2f635dd25cfff06bd50df6ae7ea203&quot;},{&quot;0020a96e7ab4607ca6b261bfe3245ffda9c746b28d3f59e83d34820ec0e2b36c139c&quot;}}, OutputType::BECH32, {{0xFFFFFFFFUL,0}, {1,2,0}, {1,2,1}, {1,2,2}, {10, 20, 30, 40, 0x80000000UL}, {10, 20, 30, 40, 0x80000001UL}, {10, 20, 30, 40, 0x80000002UL}});</span></a>
<a name="330"><span class="lineNum">     330 </span><span class="lineCov">          1 :     Check(&quot;sh(wsh(multi(16,KzoAz5CanayRKex3fSLQ2BwJpN7U52gZvxMyk78nDMHuqrUxuSJy,KwGNz6YCCQtYvFzMtrC6D3tKTKdBBboMrLTsjr2NYVBwapCkn7Mr,KxogYhiNfwxuswvXV66eFyKcCpm7dZ7TqHVqujHAVUjJxyivxQ9X,L2BUNduTSyZwZjwNHynQTF14mv2uz2NRq5n5sYWTb4FkkmqgEE9f,L1okJGHGn1kFjdXHKxXjwVVtmCMR2JA5QsbKCSpSb7ReQjezKeoD,KxDCNSST75HFPaW5QKpzHtAyaCQC7p9Vo3FYfi2u4dXD1vgMiboK,L5edQjFtnkcf5UWURn6UuuoFrabgDQUHdheKCziwN42aLwS3KizU,KzF8UWFcEC7BYTq8Go1xVimMkDmyNYVmXV5PV7RuDicvAocoPB8i,L3nHUboKG2w4VSJ5jYZ5CBM97oeK6YuKvfZxrefdShECcjEYKMWZ,KyjHo36dWkYhimKmVVmQTq3gERv3pnqA4xFCpvUgbGDJad7eS8WE,KwsfyHKRUTZPQtysN7M3tZ4GXTnuov5XRgjdF2XCG8faAPmFruRF,KzCUbGhN9LJhdeFfL9zQgTJMjqxdBKEekRGZX24hXdgCNCijkkap,KzgpMBwwsDLwkaC5UrmBgCYaBD2WgZ7PBoGYXR8KT7gCA9UTN5a3,KyBXTPy4T7YG4q9tcAM3LkvfRpD1ybHMvcJ2ehaWXaSqeGUxEdkP,KzJDe9iwJRPtKP2F2AoN6zBgzS7uiuAwhWCfGdNeYJ3PC1HNJ8M8,L1xbHrxynrqLKkoYc4qtoQPx6uy5qYXR5ZDYVYBSRmCV5piU3JG9)))&quot;,&quot;sh(wsh(multi(16,03669b8afcec803a0d323e9a17f3ea8e68e8abe5a278020a929adbec52421adbd0,0260b2003c386519fc9eadf2b5cf124dd8eea4c4e68d5e154050a9346ea98ce600,0362a74e399c39ed5593852a30147f2959b56bb827dfa3e60e464b02ccf87dc5e8,0261345b53de74a4d721ef877c255429961b7e43714171ac06168d7e08c542a8b8,02da72e8b46901a65d4374fe6315538d8f368557dda3a1dcf9ea903f3afe7314c8,0318c82dd0b53fd3a932d16e0ba9e278fcc937c582d5781be626ff16e201f72286,0297ccef1ef99f9d73dec9ad37476ddb232f1238aff877af19e72ba04493361009,02e502cfd5c3f972fe9a3e2a18827820638f96b6f347e54d63deb839011fd5765d,03e687710f0e3ebe81c1037074da939d409c0025f17eb86adb9427d28f0f7ae0e9,02c04d3a5274952acdbc76987f3184b346a483d43be40874624b29e3692c1df5af,02ed06e0f418b5b43a7ec01d1d7d27290fa15f75771cb69b642a51471c29c84acd,036d46073cbb9ffee90473f3da429abc8de7f8751199da44485682a989a4bebb24,02f5d1ff7c9029a80a4e36b9a5497027ef7f3e73384a4a94fbfe7c4e9164eec8bc,02e41deffd1b7cce11cde209a781adcffdabd1b91c0ba0375857a2bfd9302419f3,02d76625f7956a7fc505ab02556c23ee72d832f1bac391bcd2d3abce5710a13d06,0399eb0a5487515802dc14544cf10b3666623762fbed2ec38a3975716e2c29c232)))&quot;, SIGNABLE, {{&quot;a9147fc63e13dc25e8a95a3cee3d9a714ac3afd96f1e87&quot;}}, OutputType::P2SH_SEGWIT);</span></a>
<a name="331"><span class="lineNum">     331 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(multi(16,KzoAz5CanayRKex3fSLQ2BwJpN7U52gZvxMyk78nDMHuqrUxuSJy,KwGNz6YCCQtYvFzMtrC6D3tKTKdBBboMrLTsjr2NYVBwapCkn7Mr,KxogYhiNfwxuswvXV66eFyKcCpm7dZ7TqHVqujHAVUjJxyivxQ9X,L2BUNduTSyZwZjwNHynQTF14mv2uz2NRq5n5sYWTb4FkkmqgEE9f,L1okJGHGn1kFjdXHKxXjwVVtmCMR2JA5QsbKCSpSb7ReQjezKeoD,KxDCNSST75HFPaW5QKpzHtAyaCQC7p9Vo3FYfi2u4dXD1vgMiboK,L5edQjFtnkcf5UWURn6UuuoFrabgDQUHdheKCziwN42aLwS3KizU,KzF8UWFcEC7BYTq8Go1xVimMkDmyNYVmXV5PV7RuDicvAocoPB8i,L3nHUboKG2w4VSJ5jYZ5CBM97oeK6YuKvfZxrefdShECcjEYKMWZ,KyjHo36dWkYhimKmVVmQTq3gERv3pnqA4xFCpvUgbGDJad7eS8WE,KwsfyHKRUTZPQtysN7M3tZ4GXTnuov5XRgjdF2XCG8faAPmFruRF,KzCUbGhN9LJhdeFfL9zQgTJMjqxdBKEekRGZX24hXdgCNCijkkap,KzgpMBwwsDLwkaC5UrmBgCYaBD2WgZ7PBoGYXR8KT7gCA9UTN5a3,KyBXTPy4T7YG4q9tcAM3LkvfRpD1ybHMvcJ2ehaWXaSqeGUxEdkP,KzJDe9iwJRPtKP2F2AoN6zBgzS7uiuAwhWCfGdNeYJ3PC1HNJ8M8,L1xbHrxynrqLKkoYc4qtoQPx6uy5qYXR5ZDYVYBSRmCV5piU3JG9))&quot;,&quot;sh(multi(16,03669b8afcec803a0d323e9a17f3ea8e68e8abe5a278020a929adbec52421adbd0,0260b2003c386519fc9eadf2b5cf124dd8eea4c4e68d5e154050a9346ea98ce600,0362a74e399c39ed5593852a30147f2959b56bb827dfa3e60e464b02ccf87dc5e8,0261345b53de74a4d721ef877c255429961b7e43714171ac06168d7e08c542a8b8,02da72e8b46901a65d4374fe6315538d8f368557dda3a1dcf9ea903f3afe7314c8,0318c82dd0b53fd3a932d16e0ba9e278fcc937c582d5781be626ff16e201f72286,0297ccef1ef99f9d73dec9ad37476ddb232f1238aff877af19e72ba04493361009,02e502cfd5c3f972fe9a3e2a18827820638f96b6f347e54d63deb839011fd5765d,03e687710f0e3ebe81c1037074da939d409c0025f17eb86adb9427d28f0f7ae0e9,02c04d3a5274952acdbc76987f3184b346a483d43be40874624b29e3692c1df5af,02ed06e0f418b5b43a7ec01d1d7d27290fa15f75771cb69b642a51471c29c84acd,036d46073cbb9ffee90473f3da429abc8de7f8751199da44485682a989a4bebb24,02f5d1ff7c9029a80a4e36b9a5497027ef7f3e73384a4a94fbfe7c4e9164eec8bc,02e41deffd1b7cce11cde209a781adcffdabd1b91c0ba0375857a2bfd9302419f3,02d76625f7956a7fc505ab02556c23ee72d832f1bac391bcd2d3abce5710a13d06,0399eb0a5487515802dc14544cf10b3666623762fbed2ec38a3975716e2c29c232))&quot;, &quot;P2SH script is too large, 547 bytes is larger than 520 bytes&quot;); // P2SH does not fit 16 compressed pubkeys in a redeemscript</span></a>
<a name="332"><span class="lineNum">     332 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(multi(2,[aaaaaaaa][aaaaaaaa]xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U/2147483647'/0,xprv9vHkqa6EV4sPZHYqZznhT2NPtPCjKuDKGY38FBWLvgaDx45zo9WQRUT3dKYnjwih2yJD9mkrocEZXo1ex8G81dwSM1fwqWpWkeS3v86pgKt/1/2/*,xprv9s21ZrQH143K3QTDL4LXw2F7HEK3wJUD2nW2nRk4stbPy6cq3jPPqjiChkVvvNKmPGJxWUtg6LnF5kejMRNNU3TGtRBeJgk33yuGBxrMPHi/10/20/30/40/*'))&quot;, &quot;wsh(multi(2,[aaaaaaaa][aaaaaaaa]xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/2147483647'/0,xpub69H7F5d8KSRgmmdJg2KhpAK8SR3DjMwAdkxj3ZuxV27CprR9LgpeyGmXUbC6wb7ERfvrnKZjXoUmmDznezpbZb7ap6r1D3tgFxHmwMkQTPH/1/2/*,xpub661MyMwAqRbcFtXgS5sYJABqqG9YLmC4Q1Rdap9gSE8NqtwybGhePY2gZ29ESFjqJoCu1Rupje8YtGqsefD265TMg7usUDFdp6W1EGMcet8/10/20/30/40/*'))&quot;, &quot;Multiple ']' characters found for a single pubkey&quot;); // Double key origin descriptor</span></a>
<a name="333"><span class="lineNum">     333 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(multi(2,[aaaagaaa]xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U/2147483647'/0,xprv9vHkqa6EV4sPZHYqZznhT2NPtPCjKuDKGY38FBWLvgaDx45zo9WQRUT3dKYnjwih2yJD9mkrocEZXo1ex8G81dwSM1fwqWpWkeS3v86pgKt/1/2/*,xprv9s21ZrQH143K3QTDL4LXw2F7HEK3wJUD2nW2nRk4stbPy6cq3jPPqjiChkVvvNKmPGJxWUtg6LnF5kejMRNNU3TGtRBeJgk33yuGBxrMPHi/10/20/30/40/*'))&quot;, &quot;wsh(multi(2,[aaagaaaa]xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/2147483647'/0,xpub69H7F5d8KSRgmmdJg2KhpAK8SR3DjMwAdkxj3ZuxV27CprR9LgpeyGmXUbC6wb7ERfvrnKZjXoUmmDznezpbZb7ap6r1D3tgFxHmwMkQTPH/1/2/*,xpub661MyMwAqRbcFtXgS5sYJABqqG9YLmC4Q1Rdap9gSE8NqtwybGhePY2gZ29ESFjqJoCu1Rupje8YtGqsefD265TMg7usUDFdp6W1EGMcet8/10/20/30/40/*'))&quot;, &quot;Fingerprint 'aaagaaaa' is not hex&quot;); // Non hex fingerprint</span></a>
<a name="334"><span class="lineNum">     334 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(multi(2,[aaaaaaaa],xprv9vHkqa6EV4sPZHYqZznhT2NPtPCjKuDKGY38FBWLvgaDx45zo9WQRUT3dKYnjwih2yJD9mkrocEZXo1ex8G81dwSM1fwqWpWkeS3v86pgKt/1/2/*,xprv9s21ZrQH143K3QTDL4LXw2F7HEK3wJUD2nW2nRk4stbPy6cq3jPPqjiChkVvvNKmPGJxWUtg6LnF5kejMRNNU3TGtRBeJgk33yuGBxrMPHi/10/20/30/40/*'))&quot;, &quot;wsh(multi(2,[aaaaaaaa],xpub69H7F5d8KSRgmmdJg2KhpAK8SR3DjMwAdkxj3ZuxV27CprR9LgpeyGmXUbC6wb7ERfvrnKZjXoUmmDznezpbZb7ap6r1D3tgFxHmwMkQTPH/1/2/*,xpub661MyMwAqRbcFtXgS5sYJABqqG9YLmC4Q1Rdap9gSE8NqtwybGhePY2gZ29ESFjqJoCu1Rupje8YtGqsefD265TMg7usUDFdp6W1EGMcet8/10/20/30/40/*'))&quot;, &quot;No key provided&quot;); // No public key with origin</span></a>
<a name="335"><span class="lineNum">     335 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(multi(2,[aaaaaaa]xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U/2147483647'/0,xprv9vHkqa6EV4sPZHYqZznhT2NPtPCjKuDKGY38FBWLvgaDx45zo9WQRUT3dKYnjwih2yJD9mkrocEZXo1ex8G81dwSM1fwqWpWkeS3v86pgKt/1/2/*,xprv9s21ZrQH143K3QTDL4LXw2F7HEK3wJUD2nW2nRk4stbPy6cq3jPPqjiChkVvvNKmPGJxWUtg6LnF5kejMRNNU3TGtRBeJgk33yuGBxrMPHi/10/20/30/40/*'))&quot;, &quot;wsh(multi(2,[aaaaaaa]xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/2147483647'/0,xpub69H7F5d8KSRgmmdJg2KhpAK8SR3DjMwAdkxj3ZuxV27CprR9LgpeyGmXUbC6wb7ERfvrnKZjXoUmmDznezpbZb7ap6r1D3tgFxHmwMkQTPH/1/2/*,xpub661MyMwAqRbcFtXgS5sYJABqqG9YLmC4Q1Rdap9gSE8NqtwybGhePY2gZ29ESFjqJoCu1Rupje8YtGqsefD265TMg7usUDFdp6W1EGMcet8/10/20/30/40/*'))&quot;, &quot;Fingerprint is not 4 bytes (7 characters instead of 8 characters)&quot;); // Too short fingerprint</span></a>
<a name="336"><span class="lineNum">     336 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(multi(2,[aaaaaaaaa]xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U/2147483647'/0,xprv9vHkqa6EV4sPZHYqZznhT2NPtPCjKuDKGY38FBWLvgaDx45zo9WQRUT3dKYnjwih2yJD9mkrocEZXo1ex8G81dwSM1fwqWpWkeS3v86pgKt/1/2/*,xprv9s21ZrQH143K3QTDL4LXw2F7HEK3wJUD2nW2nRk4stbPy6cq3jPPqjiChkVvvNKmPGJxWUtg6LnF5kejMRNNU3TGtRBeJgk33yuGBxrMPHi/10/20/30/40/*'))&quot;, &quot;wsh(multi(2,[aaaaaaaaa]xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/2147483647'/0,xpub69H7F5d8KSRgmmdJg2KhpAK8SR3DjMwAdkxj3ZuxV27CprR9LgpeyGmXUbC6wb7ERfvrnKZjXoUmmDznezpbZb7ap6r1D3tgFxHmwMkQTPH/1/2/*,xpub661MyMwAqRbcFtXgS5sYJABqqG9YLmC4Q1Rdap9gSE8NqtwybGhePY2gZ29ESFjqJoCu1Rupje8YtGqsefD265TMg7usUDFdp6W1EGMcet8/10/20/30/40/*'))&quot;, &quot;Fingerprint is not 4 bytes (9 characters instead of 8 characters)&quot;); // Too long fingerprint</span></a>
<a name="337"><span class="lineNum">     337 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;multi(a,L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1,5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)&quot;, &quot;multi(a,03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd,04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)&quot;, &quot;Multi threshold 'a' is not valid&quot;); // Invalid threshold</span></a>
<a name="338"><span class="lineNum">     338 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;multi(0,L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1,5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)&quot;, &quot;multi(0,03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd,04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)&quot;, &quot;Multisig threshold cannot be 0, must be at least 1&quot;); // Threshold of 0</span></a>
<a name="339"><span class="lineNum">     339 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;multi(3,L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1,5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)&quot;, &quot;multi(3,03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd,04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)&quot;, &quot;Multisig threshold cannot be larger than the number of keys; threshold is 3 but only 2 keys specified&quot;); // Threshold larger than number of keys</span></a>
<a name="340"><span class="lineNum">     340 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;multi(3,KzoAz5CanayRKex3fSLQ2BwJpN7U52gZvxMyk78nDMHuqrUxuSJy,KwGNz6YCCQtYvFzMtrC6D3tKTKdBBboMrLTsjr2NYVBwapCkn7Mr,KxogYhiNfwxuswvXV66eFyKcCpm7dZ7TqHVqujHAVUjJxyivxQ9X,L2BUNduTSyZwZjwNHynQTF14mv2uz2NRq5n5sYWTb4FkkmqgEE9f)&quot;, &quot;multi(3,03669b8afcec803a0d323e9a17f3ea8e68e8abe5a278020a929adbec52421adbd0,0260b2003c386519fc9eadf2b5cf124dd8eea4c4e68d5e154050a9346ea98ce600,0362a74e399c39ed5593852a30147f2959b56bb827dfa3e60e464b02ccf87dc5e8,0261345b53de74a4d721ef877c255429961b7e43714171ac06168d7e08c542a8b8)&quot;, &quot;Cannot have 4 pubkeys in bare multisig; only at most 3 pubkeys&quot;); // Threshold larger than number of keys</span></a>
<a name="341"><span class="lineNum">     341 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(multi(16,KzoAz5CanayRKex3fSLQ2BwJpN7U52gZvxMyk78nDMHuqrUxuSJy,KwGNz6YCCQtYvFzMtrC6D3tKTKdBBboMrLTsjr2NYVBwapCkn7Mr,KxogYhiNfwxuswvXV66eFyKcCpm7dZ7TqHVqujHAVUjJxyivxQ9X,L2BUNduTSyZwZjwNHynQTF14mv2uz2NRq5n5sYWTb4FkkmqgEE9f,L1okJGHGn1kFjdXHKxXjwVVtmCMR2JA5QsbKCSpSb7ReQjezKeoD,KxDCNSST75HFPaW5QKpzHtAyaCQC7p9Vo3FYfi2u4dXD1vgMiboK,L5edQjFtnkcf5UWURn6UuuoFrabgDQUHdheKCziwN42aLwS3KizU,KzF8UWFcEC7BYTq8Go1xVimMkDmyNYVmXV5PV7RuDicvAocoPB8i,L3nHUboKG2w4VSJ5jYZ5CBM97oeK6YuKvfZxrefdShECcjEYKMWZ,KyjHo36dWkYhimKmVVmQTq3gERv3pnqA4xFCpvUgbGDJad7eS8WE,KwsfyHKRUTZPQtysN7M3tZ4GXTnuov5XRgjdF2XCG8faAPmFruRF,KzCUbGhN9LJhdeFfL9zQgTJMjqxdBKEekRGZX24hXdgCNCijkkap,KzgpMBwwsDLwkaC5UrmBgCYaBD2WgZ7PBoGYXR8KT7gCA9UTN5a3,KyBXTPy4T7YG4q9tcAM3LkvfRpD1ybHMvcJ2ehaWXaSqeGUxEdkP,KzJDe9iwJRPtKP2F2AoN6zBgzS7uiuAwhWCfGdNeYJ3PC1HNJ8M8,L1xbHrxynrqLKkoYc4qtoQPx6uy5qYXR5ZDYVYBSRmCV5piU3JG9,L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))&quot;,&quot;sh(multi(16,03669b8afcec803a0d323e9a17f3ea8e68e8abe5a278020a929adbec52421adbd0,0260b2003c386519fc9eadf2b5cf124dd8eea4c4e68d5e154050a9346ea98ce600,0362a74e399c39ed5593852a30147f2959b56bb827dfa3e60e464b02ccf87dc5e8,0261345b53de74a4d721ef877c255429961b7e43714171ac06168d7e08c542a8b8,02da72e8b46901a65d4374fe6315538d8f368557dda3a1dcf9ea903f3afe7314c8,0318c82dd0b53fd3a932d16e0ba9e278fcc937c582d5781be626ff16e201f72286,0297ccef1ef99f9d73dec9ad37476ddb232f1238aff877af19e72ba04493361009,02e502cfd5c3f972fe9a3e2a18827820638f96b6f347e54d63deb839011fd5765d,03e687710f0e3ebe81c1037074da939d409c0025f17eb86adb9427d28f0f7ae0e9,02c04d3a5274952acdbc76987f3184b346a483d43be40874624b29e3692c1df5af,02ed06e0f418b5b43a7ec01d1d7d27290fa15f75771cb69b642a51471c29c84acd,036d46073cbb9ffee90473f3da429abc8de7f8751199da44485682a989a4bebb24,02f5d1ff7c9029a80a4e36b9a5497027ef7f3e73384a4a94fbfe7c4e9164eec8bc,02e41deffd1b7cce11cde209a781adcffdabd1b91c0ba0375857a2bfd9302419f3,02d76625f7956a7fc505ab02556c23ee72d832f1bac391bcd2d3abce5710a13d06,0399eb0a5487515802dc14544cf10b3666623762fbed2ec38a3975716e2c29c232,03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))&quot;, &quot;Cannot have 17 keys in multisig; must have between 1 and 16 keys, inclusive&quot;); // Cannot have more than 16 keys in a multisig</span></a>
<a name="342"><span class="lineNum">     342 </span>            : </a>
<a name="343"><span class="lineNum">     343 </span>            :     // Check for invalid nesting of structures</a>
<a name="344"><span class="lineNum">     344 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)&quot;, &quot;sh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)&quot;, &quot;A function is needed within P2SH&quot;); // P2SH needs a script, not a key</span></a>
<a name="345"><span class="lineNum">     345 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(combo(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))&quot;, &quot;sh(combo(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))&quot;, &quot;Cannot have combo in non-top level&quot;); // Old must be top level</span></a>
<a name="346"><span class="lineNum">     346 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)&quot;, &quot;wsh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)&quot;, &quot;A function is needed within P2WSH&quot;); // P2WSH needs a script, not a key</span></a>
<a name="347"><span class="lineNum">     347 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(wpkh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))&quot;, &quot;wsh(wpkh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))&quot;, &quot;Cannot have wpkh within wsh&quot;); // Cannot embed witness inside witness</span></a>
<a name="348"><span class="lineNum">     348 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(sh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)))&quot;, &quot;wsh(sh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))&quot;, &quot;Cannot have sh in non-top level&quot;); // Cannot embed P2SH inside P2WSH</span></a>
<a name="349"><span class="lineNum">     349 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(sh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)))&quot;, &quot;sh(sh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))&quot;, &quot;Cannot have sh in non-top level&quot;); // Cannot embed P2SH inside P2SH</span></a>
<a name="350"><span class="lineNum">     350 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;wsh(wsh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)))&quot;, &quot;wsh(wsh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))&quot;, &quot;Cannot have wsh within wsh&quot;); // Cannot embed P2WSH inside P2WSH</span></a>
<a name="351"><span class="lineNum">     351 </span>            : </a>
<a name="352"><span class="lineNum">     352 </span>            :     // Checksums</a>
<a name="353"><span class="lineNum">     353 </span><span class="lineCov">          2 :     Check(&quot;sh(multi(2,[00000000/111'/222]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0))#ggrsrxfy&quot;, &quot;sh(multi(2,[00000000/111'/222]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0))#tjg09x5t&quot;, DEFAULT, {{&quot;a91445a9a622a8b0a1269944be477640eedc447bbd8487&quot;}}, OutputType::LEGACY, {{0x8000006FUL,222},{0}});</span></a>
<a name="354"><span class="lineNum">     354 </span><span class="lineCov">          2 :     Check(&quot;sh(multi(2,[00000000/111'/222]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0))&quot;, &quot;sh(multi(2,[00000000/111'/222]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0))&quot;, DEFAULT, {{&quot;a91445a9a622a8b0a1269944be477640eedc447bbd8487&quot;}}, OutputType::LEGACY, {{0x8000006FUL,222},{0}});</span></a>
<a name="355"><span class="lineNum">     355 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(multi(2,[00000000/111'/222]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0))#&quot;, &quot;sh(multi(2,[00000000/111'/222]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0))#&quot;, &quot;Expected 8 character checksum, not 0 characters&quot;); // Empty checksum</span></a>
<a name="356"><span class="lineNum">     356 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(multi(2,[00000000/111'/222]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0))#ggrsrxfyq&quot;, &quot;sh(multi(2,[00000000/111'/222]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0))#tjg09x5tq&quot;, &quot;Expected 8 character checksum, not 9 characters&quot;); // Too long checksum</span></a>
<a name="357"><span class="lineNum">     357 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(multi(2,[00000000/111'/222]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0))#ggrsrxf&quot;, &quot;sh(multi(2,[00000000/111'/222]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0))#tjg09x5&quot;, &quot;Expected 8 character checksum, not 7 characters&quot;); // Too short checksum</span></a>
<a name="358"><span class="lineNum">     358 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(multi(3,[00000000/111'/222]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0))#ggrsrxfy&quot;, &quot;sh(multi(3,[00000000/111'/222]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0))#tjg09x5t&quot;, &quot;Provided checksum 'tjg09x5t' does not match computed checksum 'd4x0uxyv'&quot;); // Error in payload</span></a>
<a name="359"><span class="lineNum">     359 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(multi(2,[00000000/111'/222]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0))#ggssrxfy&quot;, &quot;sh(multi(2,[00000000/111'/222]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0))#tjq09x4t&quot;, &quot;Provided checksum 'tjq09x4t' does not match computed checksum 'tjg09x5t'&quot;); // Error in checksum</span></a>
<a name="360"><span class="lineNum">     360 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;sh(multi(2,[00000000/111'/222]xprvA1RpRA33e1JQ7ifknakTFpgNXPmW2YvmhqLQYMmrj4xJXXWYpDPS3xz7iAxn8L39njGVyuoseXzU6rcxFLJ8HFsTjSyQbLYnMpCqE2VbFWc,xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0))##ggssrxfy&quot;, &quot;sh(multi(2,[00000000/111'/222]xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL,xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0))##tjq09x4t&quot;, &quot;Multiple '#' symbols&quot;); // Error in checksum</span></a>
<a name="361"><span class="lineNum">     361 </span>            : </a>
<a name="362"><span class="lineNum">     362 </span>            :     // Addr and raw tests</a>
<a name="363"><span class="lineNum">     363 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;&quot;, &quot;addr(asdf)&quot;, &quot;Address is not valid&quot;); // Invalid address</span></a>
<a name="364"><span class="lineNum">     364 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;&quot;, &quot;raw(asdf)&quot;, &quot;Raw script is not hex&quot;); // Invalid script</span></a>
<a name="365"><span class="lineNum">     365 </span><span class="lineCov">          1 :     CheckUnparsable(&quot;&quot;, &quot;raw(Ü)#00000000&quot;, &quot;Invalid characters in payload&quot;); // Invalid chars</span></a>
<a name="366"><span class="lineNum">     366 </span><span class="lineCov">          1 : }</span></a>
<a name="367"><span class="lineNum">     367 </span>            : </a>
<a name="368"><span class="lineNum">     368 </span><span class="lineCov">         89 : BOOST_AUTO_TEST_SUITE_END()</span></a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.15</a></td></tr>
  </table>
  <br>

</body>
</html>
